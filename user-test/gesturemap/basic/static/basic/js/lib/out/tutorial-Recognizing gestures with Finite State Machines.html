<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tutorial: Recognizing gestures with Finite State Machines | Docs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 0px; height: 0px">
        
            <a href="http://dipartimenti.unica.it/matematicaeinformatica/" rel="noopener noreferrer" target="_blank">
                <img src="https://www.unica.it/static/resources/static/img/logo_unica.svg" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Docs</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>API</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Tutorials</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Tutorials</h3><ul><li><a href="tutorial-Managing the grid map.html">Managing the grid map</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Managing the grid map_sub"></div></li><li><a href="tutorial-Recognizing gestures with Deictic.html">Recognizing gestures with Deictic</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Recognizing gestures with Deictic_sub"></div></li><li><a href="tutorial-Recognizing gestures with Finite State Machines.html">Recognizing gestures with Finite State Machines</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Recognizing gestures with Finite State Machines_sub"></div></li><li><a href="tutorial-Recognizing gestures with Machine Learning.html">Recognizing gestures with Machine Learning</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Recognizing gestures with Machine Learning_sub"></div></li><li><a href="tutorial-Registering strokes.html">Registering strokes</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Registering strokes_sub"></div></li><li><a href="tutorial-Using the Octopocus feedback.html">Using the Octopocus feedback</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Using the Octopocus feedback_sub"></div></li><li><a href="tutorial-Using the line feedback.html">Using the line feedback</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Using the line feedback_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="Grid.LineFeedback.html">LineFeedback</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Grid.LineFeedback_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Grid.LineFeedback.html#layer">layer</a></li><li><a href="Grid.LineFeedback.html#line">line</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Grid.LineFeedback.html#addPoint">addPoint</a></li><li><a href="Grid.LineFeedback.html#clearLine">clearLine</a></li><li><a href="Grid.LineFeedback.html#init">init</a></li></ul></div></li><li><a href="Grid.Octopocus.html">Octopocus</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Grid.Octopocus_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Grid.Octopocus.html#feedback">feedback</a></li><li><a href="Grid.Octopocus.html#feedforward">feedforward</a></li><li><a href="Grid.Octopocus.html#layer">layer</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Grid.Octopocus.html#clear">clear</a></li><li><a href="Grid.Octopocus.html#init">init</a></li><li><a href="Grid.Octopocus.html#start">start</a></li><li><a href="Grid.Octopocus.html#update">update</a></li></ul></div></li><li><a href="Grid.Scene.html">Scene</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Grid.Scene_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Grid.Scene.html#imgLayer">imgLayer</a></li><li><a href="Grid.Scene.html#layer">layer</a></li><li><a href="Grid.Scene.html#state">state</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Grid.Scene.html#clearCell">clearCell</a></li><li><a href="Grid.Scene.html#init">init</a></li><li><a href="Grid.Scene.html#setMonster">setMonster</a></li><li><a href="Grid.Scene.html#setTreasure">setTreasure</a></li></ul></div></li><li><a href="Input.AngleFSM.html">AngleFSM</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Input.AngleFSM_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Input.AngleFSM.html#state">state</a></li><li><a href="Input.AngleFSM.html#states">states</a></li><li><a href="Input.AngleFSM.html#tolerance">tolerance</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Input.AngleFSM.html#init">init</a></li><li><a href="Input.AngleFSM.html#push">push</a></li><li><a href="Input.AngleFSM.html#restart">restart</a></li></ul></div></li><li><a href="Input.Deictic.html">Deictic</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Input.Deictic_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Input.Deictic.html#eval">eval</a></li><li><a href="Input.Deictic.html#init">init</a></li><li><a href="Input.Deictic.html#recognisedGesture">recognisedGesture</a></li></ul></div></li><li><a href="Input.Event.html">Event</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Input.Event_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Input.Event.html#add">add</a></li><li><a href="Input.Event.html#remove">remove</a></li><li><a href="Input.Event.html#trigger">trigger</a></li></ul></div></li><li><a href="Input.MachineLearning.html">MachineLearning</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Input.MachineLearning_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Input.MachineLearning.html#eval">eval</a></li><li><a href="Input.MachineLearning.html#init">init</a></li><li><a href="Input.MachineLearning.html#recognisedGesture">recognisedGesture</a></li></ul></div></li><li><a href="Input.Point2D.html">Point2D</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Input.Point2D_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Input.Point2D.html#x">x</a></li><li><a href="Input.Point2D.html#y">y</a></li></ul></div></li><li><a href="Input.StrokeInput.html">StrokeInput</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Input.StrokeInput_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Input.StrokeInput.html#onStrokeBegin">onStrokeBegin</a></li><li><a href="Input.StrokeInput.html#onStrokeChange">onStrokeChange</a></li><li><a href="Input.StrokeInput.html#onStrokeEnd">onStrokeEnd</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Namespaces</h3><ul><li><a href="Grid.html">Grid</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Grid_sub"><div class="member-type">Typedef</div><ul class="inner"><li><a href="Grid.html#~Feedforward">Feedforward</a></li><li><a href="Grid.html#~FeedforwardState">FeedforwardState</a></li></ul></div></li><li><a href="Input.html">Input</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Input_sub"><div class="member-type">Typedef</div><ul class="inner"><li><a href="Input.html#~AngleFSMState">AngleFSMState</a></li><li><a href="Input.html#~DeicticEvaluation">DeicticEvaluation</a></li><li><a href="Input.html#~DeicticEvaluationPart">DeicticEvaluationPart</a></li><li><a href="Input.html#~DeicticGesture">DeicticGesture</a></li><li><a href="Input.html#~DollarSamples">DollarSamples</a></li><li><a href="Input.html#~DollarTraining">DollarTraining</a></li><li><a href="Input.html#~MLEvaluation">MLEvaluation</a></li><li><a href="Input.html#~StrokeChangeDescriptor">StrokeChangeDescriptor</a></li></ul></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    

<section>
    <header>
        

        <h2>Recognizing gestures with Finite State Machines</h2>
    </header>

    
        <article class="readme">
            <h1>Recognizing Gestures with Finite State Machines</h1><p>In this test, we consider gesture recognition with the Finite State Machines (FSM) as a sample heuristic approach. 
They are quite used in gesture interface programming, for instance in 
<a href="https://developer.apple.com/documentation/uikit/touches_presses_and_gestures/implementing_a_custom_gesture_recognizer/about_the_gesture_recognizer_state_machine">
iOS</a>. </p>
<p>We provide a simplified API for building FSMs able to recognize linear stroke gestures. The heuristic consists of a 
simple angle check, considering the previous and the current stroke point. At each update, the FSM
checks if the movement direction angle defined by the two points is contained in a  specified range. 
If so, the recognition continues. Otherwise, the stroke is rejected. </p>
<p>For instance, consider the ideal trajectory of the V gesture in the figure below. In the first part (in red),
the user moves along the 300 degrees direction. The movement angle is depicted in the first circle.<br>However, maintaining the direction precisely is impossible for a user. So, we can create a 30-degrees tolerance range 
around the ideal direction, which corresponds to the green sector (minimum 285, maximum 315). 
In a similar way, we can build a tolerance range around the direction for the second part 
(in blue, minimum 45, maximum 75 degrees). Such ranges can be found empirically by trial and error. </p>
<p><img src="./tutorials/img/5-1-angles.png" alt="A sample grid map" style="width: 600px;"/> </p>
<p>The recognition state machine for a V gesture is depicted in the following figure. At the beginning the FSM is in the 
<code>Start</code> state. If the user follows correctly the 300 degrees direction, it fires the transition to the <code>Part 1</code> state. 
Otherwise it fires the transition to the <code>Error</code> state and the recognition ends.
In the correct case, the FSM remains in the <code>Part 1</code> state util either the user misses the direction (<code>Error</code> state) or
the stroke starts moving along the 60 degrees direction. In the latter case, the FMS fires the transition towards <code>Part 2</code>.
Other following movements in the 60 degrees direction maintain the FMS in this state. Again, moving outside the direction
will fire a transition towards the <code>Error</code> state. 
If the user ends the stroke while the FSM is in <code>Part 2</code> state, the gesture is recognized.</p>
<p><img src="./tutorials/img/5-2-angles.png" alt="A sample grid map" style="width: 500px;"/> </p>
<h2>Defining a FSM</h2><p>The <a href="Input.AngleFSM.html">Input.AngleFSM</a> class simplifies the creation of stroke recognition FSMs. 
In the initialization step, it  accepts a configuration object 
defining the angle range for each state (the <code>min</code> and <code>max</code> properties). 
The <code>tolerance</code> parameter defines how many consecutive samples outside the current state range are needed for firing
the transition towards the error state. Symmetrically, it defines also how many consecutive samples in the range of 
the next state are needed for firing the transition. 
It allows having a recognizer that is more robust to the input noise, but it  delays the transitions. 
For creating a good interface, we need to find a good balance between the two aspects. </p>
<pre class="prettyprint source"><code>var angleFSM = Input.AngleFSM();
var midRange = 15;
var tolerance = 5;

angleFSM.init([
   {min: 300 - midRange, max: 300 + midRange},
   {min: 60 -  midRange, max: 60 +  midRange}
 ], tolerance);</code></pre><h2>Firing transitions and inspecting the current state</h2><p>The current state of a <a href="Input.AngleFSM.html">Input.AngleFSM</a> can be accessed through its <code>state</code> member. A non-negative value
is the index of the range entry in the <code>states</code> member (the array passed in the <code>init</code> method). 
For instance, in the FSM for the V gesture, a <code>state === 0</code> corresponds to the red arrow, corresponding to first entry 
in the <code>states</code> array. If <code>state &lt; 0</code>, the FSM is in the <code>Error</code> state.</p>
<pre class="prettyprint source"><code>
// tests if the FSM is in the error state
if(angleFSM.state &lt; 0){
   // error 
}

// checks if a gesture has been recognized
if(angleFSM.state === angleFSM.states.length - 1){
    // gesture recognized
}</code></pre><p>In order to receive an update, the FSM requires two <a href="Input.Point2D.html">Input.Point2D</a> instances: the <code>current</code>  and the <code>previous</code> 
stroke position. The update is fired calling the <code>push</code> method, which modifies the <code>state</code> variable if needed.
We receive the stroke position from a {@ Input.StrokeInput} object. </p>
<pre class="prettyprint source"><code>var scene = new Grid.Scene();
scene.init();
var input = new Input.StrokeInput(scene.layer);

input.onStrokeChange.add(function (event) {
    // get the current and the previous stroke position
    var current = event.d;
    var previous = event.d.buffer[event.d.buffer.length - 2];

    // update the FSM
    angleFSM.push(current, previous);

    // ... do something inspecting the FSM
});</code></pre><p>The same <a href="Input.AngleFSM.html">Input.AngleFSM</a> can be reused for recognizing more than one stroke. Calling the <code>restart</code> method
resets the current FSM state to <code>Start</code>. Usually, we reset the FSM when the stroke starts. </p>
<pre class="prettyprint source"><code>input.onStrokeBegin.add(function(event){
    angleFSM.restart();
});</code></pre>
        </article>
    
</section>



</div>

<footer>
    <img class="logo" src="https://www.unica.it/static/resources/static/img/logo_unica.svg" style="width: 0px; height: 0px">
    <div class="footer-text">Gesture UI Development Test</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        showLnbExamples();
    </script>

</body>
</html>